# 执行器配置与测试

<Badge type="tip" text="PX4 v1.14" />

_执行器设置_ 视图用于自定义飞行器的具体几何结构，将执行器和电机分配给飞控输出，以及测试执行器和电机响应。

## 概述

在 _QGroundControl_ 中打开视图：**"Q"（应用菜单） > 飞行器设置 > 执行器**（标签页）。
显示的元素取决于[选择的机架](../config/airframe.md)，输出按默认映射显示，如[机架参考](../airframes/airframe_reference.md)所示。

视图有三个部分：

- [几何结构](#几何结构)：为[选择的机架](../config/airframe.md)配置几何结构。
  这包括[电机](#电机几何结构)的数量、位置和属性，以及[操纵面](#操纵面几何结构)和[电机倾转舵机](#电机倾转舵机几何结构)的数量和属性。
- [执行器输出](#执行器输出)：将电机、操纵面和其他执行器分配到特定输出。
- [执行器测试](#执行器测试)：测试电机和执行器是否按预期方向/速度移动。

四轴飞行器可能有类似下面显示的设置屏幕。
这定义了一个具有X型几何结构的4旋翼飞行器。
它将4个电机映射到AUX1到AUX4输出，并指定连接到DShot1200 ESC。
它还映射PWM400 AUX输出用于控制降落伞和起落架。

![Actuators MC (QGC)](../../assets/config/actuators/qgc_actuators_mc_aux.png)

::: info
默认情况下只显示最常见的设置。
选择右上角的**高级**复选框以显示所有设置。
:::

## 几何结构

几何结构部分用于设置选定[机架](../config/airframe.md)的任何可配置几何相关参数。
这包括[电机](#电机几何结构)的数量和位置，以及[操纵面](#操纵面几何结构)的数量、功能和属性。
对于VTOL倾转旋翼飞行器，还包括[倾转舵机](#电机倾转舵机几何结构)的数量和属性。

::: info
UI针对选定的机架进行定制：

- 只显示所选机架类型的_可配置_字段；机架不可配置的字段将被隐藏。
- 电机位置图表目前只针对多旋翼机架显示。
  :::

### 电机几何结构

电机几何结构部分允许您设置电机数量、相对位置和每个电机的其他属性。

大多数电机属性适用于所有机架。
少数属性适用于特定机架。
例如，`倾转控制`和`轴向`仅与[倾转旋翼VTOL](#电机几何结构-vtol倾转旋翼)和[标准VTOL](#电机几何结构-标准vtol)飞行器相关。

多旋翼机架的几何配置提供了一个显示每个电机相对x,y位置的图表。
参见[机架参考](../airframes/airframe_reference.md)了解其他机架的电机位置的广泛理解。

以下部分提供了核心几何概念和多种不同机架的配置。

#### 电机几何结构：多旋翼

下图显示了四轴多旋翼机架的几何设置，包括和不包括高级设置。

![Geometry MC (QGC)](../../assets/config/actuators/qgc_actuators_mc_geometry_marked.png)

首先，**电机**下拉设置允许您选择电机数量（上例为4个）。

然后您可以为每个电机设置：

- `位置X`：[X位置](#电机位置坐标系统)，单位米。
- `位置Y`：[Y位置](#电机位置坐标系统)，单位米。
- `位置Z`：[Z位置](#电机位置坐标系统)，单位米。
- （高级）`逆时针方向`：复选框，指示电机逆时针旋转（取消选中表示顺时针）。
- （高级）`双向`：复选框，指示电机是[双向电机](#双向电机)
- （高级）`转换率`：设置电机输出达到最大值所需的最短时间。
  更多信息请参考[操纵面几何结构](#操纵面几何结构)部分

::: info
`X`、`Y`、`Z`位置在[FRD坐标系中，相对于_重心_](#电机位置坐标系统)。
注意，这可能与飞控的位置不同！
:::

#### 电机几何结构：VTOL四轴尾座式

[VTOL四轴尾座式](../airframes/airframe_reference.md#vtol-tailsitter)的电机几何结构如下所示（配置其他尾座式VTOL飞行器的方法类似）。

电机具有与[多旋翼几何结构](#电机几何结构-多旋翼)相同的配置字段。

![Geometry motor: tailsitter vtol](../../assets/config/actuators/qgc_geometry_tailsitter_motors.png)

#### 电机几何结构：VTOL倾转旋翼

[通用四翼VTOL倾转旋翼](../airframes/airframe_reference.md#vtol_vtol_tiltrotor_generic_quadplane_vtol_tiltrotor)的电机几何结构如下所示（配置其他[VTOL倾转旋翼](../airframes/airframe_reference.md#vtol_vtol_tiltrotor_generic_quadplane_vtol_tiltrotor)的方法类似）。

![Geometry motor: tiltrotor vtol](../../assets/config/actuators/qgc_geometry_tiltrotor_motors.png)

- `倾转控制`：用于倾转电机的关联舵机。
  该舵机的属性在[电机倾转舵机几何结构](#电机倾转舵机几何结构)中定义。

#### 电机几何结构：标准VTOL

[通用标准VTOL](../airframes/airframe_reference.md#vtol_standard_vtol_generic_standard_vtol)的电机几何结构如下所示（配置其他"标准VTOL"的方法类似）。

![Geometry motor: standard vtol](../../assets/config/actuators/qgc_geometry_standard_vtol_motors.png)

电机具有与[多旋翼几何结构](#电机几何结构-多旋翼)大部分相同的配置字段。
有一个额外字段指示电机移动飞行器的方向（对于标准VTOL，悬停电机通常设置为"向上"，推进电机设置为"向前"）。

- `轴向`：`向上`、`向下`、`向前`、`向后`、`向左`、`向右`、`自定义`之一
  - 如果选择`自定义`，则UI显示三个额外字段用于设置电机方向。

#### 电机几何结构：其他飞行器

其他飞行器类型将为其机架类型定义适当的电机几何结构。
这些电机通常具有与上面显示的相同类型的属性。

例如，固定翼飞行器可能只有一个推进电机，而具有差分转向的地面车辆将有一个用于油门和一个用于转向的电机。

#### 电机位置坐标系统

电机位置的坐标系是FRD（在机体坐标系中），其中X轴指向前方，Y轴指向右侧，Z轴向下。

原点是飞行器的**重心（COG）**。
这可能**不**与自驾仪的位置相同。

![Actuators CG reference diagram](../../assets/config/actuators/quadcopter_actuators_cg_reference.png)

#### 双向电机

一些飞行器可能使用双向电机（即支持两个方向旋转的电机）。
例如，想要前进和后退的地面车辆，或具有可以任一方向转动的推进电机的VTOL飞行器。

如果使用双向电机，请确保为这些电机选择**可逆**复选框（复选框显示为"高级"选项）。

![Reversible](../../assets/config/actuators/qgc_geometry_reversible_marked.png)

请注意，您还需要确保与双向电机关联的ESC配置得当（例如为DShot ESC启用3D模式，可通过[DShot命令](../peripherals/dshot.md#commands)实现）。

### 操纵面几何结构

几何面板的操纵面部分允许您设置飞行器上存在的操纵面的数量和类型。
在某些情况下，您可能还需要设置配平和转换率值。
更高级的用户还可以配置滚转比例、偏航比例和俯仰比例（通常默认值是可接受的，不需要此设置）。
下面显示了具有两个副翼的飞行器的"示例"操纵面部分。
注意副翼只影响滚转，因此俯仰和偏航字段被禁用。

![Control Surface Setup Example](../../assets/config/actuators/control_surfaces_geometry.png)

::: info
默认情况下只显示最常见的设置。
选择视图右上角的**高级**复选框以显示所有设置。
:::

字段包括：

- `操纵面`：操纵面的数量（首先设置此项！）
- `类型`：每个操纵面的类型：`左副翼`、`右副翼`、`升降舵`、`方向舵`、`左升降副翼`、`右升降副翼`、`左V型尾翼`、`右V型尾翼`、`左襟翼`、`右襟翼`、`空气刹车`、`自定义`。
- `滚转力矩`：执行器绕滚转轴的有效性（标准化：-1到1）。
  [通常您应该使用默认执行器值](#执行器滚转俯仰和偏航比例)。
- `俯仰力矩`：执行器绕俯仰轴的有效性（标准化：-1到1）。
  [通常您应该使用默认执行器值](#执行器滚转俯仰和偏航比例)。
- `偏航力矩`：执行器绕偏航轴的有效性（标准化：-1到1）。
  [通常您应该使用默认执行器值](#执行器滚转俯仰和偏航比例)。
- `配平`：添加到执行器的偏移量，使其在无输入时居中。
  这可能通过试验和错误来确定。
- <a id="slew_rate"></a>（高级）`转换率`：限制电机/舵机信号通过其完整输出范围所允许的最短时间，单位为秒。
  - 该设置限制执行器的变化率（如果未指定则不应用速率限制）。
    它适用于移动太快可能损坏或引起飞行扰动的执行器——例如倾转旋翼VTOL飞行器上的倾转执行器，或快速移动的襟翼。
  - 例如，设置为2.0意味着电机/舵机不会被命令以在少于2秒内完成操作的速率从0移动到1（对于可逆电机，范围是-1到1）。
- （高级）`襟翼比例`：该执行器在"全襟翼配置"[0, 1]时的偏转程度（见下面的[襟翼比例和扰流板比例配置](#襟翼比例和扰流板比例配置)）。
  可用于将气动表面配置为襟翼或通过主襟翼补偿产生的力矩。
- （高级）`扰流板比例`：该执行器在"全扰流板配置"[0, 1]时的偏转程度（见下面的[襟翼比例和扰流板比例配置](#襟翼比例和扰流板比例配置)）。
  可用于将气动表面配置为扰流板或通过主扰流板补偿产生的力矩。
- （仅VTOL）`悬停时锁定操纵面`：
  - `启用`：大多数飞行器在悬停时不使用操纵面。使用此设置锁定它们，这样它们就不会影响飞行器动力学。
  - `禁用`：为在悬停时使用操纵面的飞行器设置，如双尾座式（使用升降副翼进行俯仰和偏航控制）。对于在悬停模式下高速移动或在强风中使用操纵面提供额外稳定的飞行器也应设置此项。

#### 襟翼比例和扰流板比例配置

"襟翼控制"和"扰流板控制"是可以由飞行员手动命令（例如使用RC）或由控制器自动设置的气动配置。
例如，飞行员或着陆系统可能启用"扰流板控制"以在着陆前降低空速。

这些配置是控制器告诉分配器应该相对于"全襟翼"或"全扰流板"配置调整机翼气动属性多少的_抽象_方式（在`[0,1]`之间，其中"1"表示全范围）。
然后分配器使用任何可用的操纵面来实现请求的配置：通常是襟翼、副翼和升降舵。

执行器UI中的`襟翼比例`和`扰流板比例`设置告知分配器副翼、升降舵、襟翼、扰流板和其他操纵面对请求的"襟翼控制"和/或"扰流板控制"值贡献多少。
具体来说，它们指示当控制器要求"全襟翼"或"全扰流板"时每个操纵面应偏转多少。

在以下示例中，飞行器有两个副翼、一个升降舵、一个方向舵和两个襟翼作为操纵面：

![Flaps and spoiler actuator configuration example](../../assets/config/actuators/qgc_actuators_tab_flaps_spoiler_setup.png)

- 襟翼的`襟翼比例`都设置为1，意味着当襟翼控制为1时它们将完全偏转。
  它们还有0.5/秒的[转换率](#slew_rate)，意味着完全偏转需要2秒（通常建议为襟翼设置转换率以减少其移动产生的扰动）。
- 副翼主要负责提供命令的滚转力矩。
  它们的`扰流板比例`也设置为0.5，如果控制器要求全扰流板配置，将额外向上偏转50%。
  因此副翼偏转是滚转力矩（非对称）偏转加上扰流板设定值（对称）偏转的总和。
- 升降舵主要负责提供俯仰力矩。
  它在`襟翼比例`和`扰流板比例`字段中也有非零条目。
  这些是添加的升降舵偏转，用于补偿襟翼和扰流板执行器产生的俯仰力矩。
  在此情况下，当襟翼完全展开时，升降舵将向上偏转0.3以抵消襟翼引起的俯仰向下力矩。

#### 执行器滚转、俯仰和偏航比例

::: info
对于大多数机架设置，每种操纵面类型的默认值不应更改。
:::

`滚转比例`、`俯仰比例`和`偏航比例`值表示执行器绕相应轴的标准化有效性。

调整这些值是一个低级/高级主题，通常只有在调整耦合操纵面（如同时控制俯仰和滚转的升降副翼）时才需要。
在这种情况下您需要了解的是：

- 输入的数字直接放入分配矩阵，然后将其反转以从所需力矩（标准化）获得控制信号。
- 增加比例将_减少_操纵面的偏转（因为它被反转）。

<!-- For more information see: []() (PX4 Dev Summit, 2022) -->

#### 操纵面偏转约定

双向移动的操纵面包括：副翼、升降副翼、V型尾翼、A型尾翼、方向舵。

为了确保这些操纵面始终按控制器正负输入的预期移动，需要有一个独立于物理舵机设置的偏转方向定义。

正输入导致正偏转。
下图显示了正输入的移动方向：

![Control Surface Deflections](../../assets/config/actuators/plane_control_surface_convention.png)

总之，正输入导致：

- **水平操纵面：**向上移动。
  包括副翼和升降副翼。
- **垂直操纵面：**向右移动。
  包括方向舵。
- **混合操纵面：**向上/向右移动。
  包括V型尾翼。A型尾翼

::: tip
只能从中性点向一个方向偏转的操纵面包括：空气刹车、扰流板和襟翼。

对于这些控制，正输入始终是从中性偏转（0：无效果，1：全效果），与控制本身移动的方向无关。
它们不响应负输入。
:::

<!-- Also see this comment: https://github.com/PX4/PX4-Autopilot/blob/96b03040491e727752751c0e0beed87f0966e6d4/src/modules/control_allocator/module.yaml#L492 -->

### 电机倾转舵机几何结构

[VTOL倾转旋翼飞行器](../frames_vtol/tiltrotor.md)可以倾转其电机以在悬停和前进飞行之间转换。
本节定义倾转舵机的属性。
这些在倾转旋翼的电机几何结构中映射到特定电机。

下面的示例显示了[上面显示的倾转旋翼电机几何结构](../config/actuators.md#电机几何结构-vtol倾转旋翼)的倾转舵机设置。

![Tilt Servo Geometry Setup Example](../../assets/config/actuators/tilt_servo_geometry_config.png)

可设置的值包括：

- `倾转舵机`：舵机（可倾转电机）的数量。
- `最小倾转角度`：相对于z轴的[最大倾转角度](#倾转舵机坐标系统)，单位度。
- `最大倾转角度`：相对于z轴的[最小倾转角度](#倾转舵机坐标系统)，单位度。
- `倾转方向`：`向前`（正x方向）或`向右`（正y方向）。
- `用于控制`：[倾转舵机用于偏航/俯仰](#倾转舵机偏航俯仰控制)
  - `无`：不使用力矩控制。
  - `偏航`：倾转舵机用于控制偏航。
  - `俯仰`：倾转舵机用于控制俯仰。
  - `偏航和俯仰`：倾转舵机用于控制偏航和俯仰。

#### 倾转舵机坐标系统

倾转旋翼角度的坐标系如下所示。
倾转角度的参考方向是垂直向上（0度）。
向飞行器前方或右侧的倾转角度为正，向后或左侧为负。

![Tilt Axis](../../assets/config/actuators/tilt_axis.png)

`最小倾转角度`和`最大倾转角度`表示倾转舵机的移动范围。
最小倾转是两个角度中较小的_数值_（非绝对值）。

如果最大/最小倾转矢量是上图所示的**P<sub>0</sub>**和**P<sub>1</sub>**，两个倾转角度都是正的，但**θ<sub>0</sub>**较小：

- `最小倾转角度` = **θ<sub>0</sub>**
- `最大倾转角度` = **θ<sub>1</sub>**

::: info
如果图表被镜像，使得**P<sub>0</sub>**和**P<sub>1</sub>**倾转到-x, -y象限，则两个倾转角度都是负的。
因为**θ<sub>1</sub>**会更负（较小）比**θ<sub>0</sub>**，它将是`最小倾转角度`。

类似地，移动的舵机：

- 在垂直和前向位置之间将有`min=0`和`max=90`。
- 围绕垂直位置对称45度将有`min=-45`和`max=45`
- 在垂直和后向位置之间将有`min=-90`和`max=0`。
  :::

`倾转方向`指示舵机是在朝向飞行器`前方`还是`右侧`的平面内倾转。
在图表上，这将由只能取值0（前方）或90（右侧）的**α**表示。

#### 偏航/俯仰控制的倾转舵机

倾转舵机可以在一个或多个轴上提供力矩，可用于偏航或俯仰飞行器：

- 偏航通常以这种方式设置，尽管在有四个或更多电机的飞行器上经常使用电机。
- 俯仰更常使用差分电机推力控制。
  使用倾转舵机控制对无法使用差分推力的机架很有用，如[双旋翼](https://www.youtube.com/watch?v=hfss7nCN40A)。

是否使用此功能在`用于控制`设置中配置。

## 执行器输出

_执行器输出_ 部分用于将特定机架使用的电机、操纵面舵机和其他执行器分配给飞控上的物理输出，并为这些输出设置参数。

![Actuator Outputs - Multicopter diagram](../../assets/config/actuators/qgc_actuators_mc_outputs.png)

为连接的飞控支持的每个输出总线显示单独的标签页：PWM MAIN（I/O板输出）、PWM AUX（FMU板输出）、UAVCAN。

电机和执行器（称为"[功能](#输出功能)"）可以分配给任何可用总线上的任何物理输出。

::: info
PWM AUX输出优于PWM MAIN输出用于控制电机（它们具有更低的延迟）。
:::

PWM输出基于硬件定时器组进行分组。
意味着一组中的所有输出必须在相同速率下以相同协议操作（例如，一组中的所有输出都以400Hz的PWM信号）。
因此，不可能在同一输出组中映射舵机和电机，因为它们通常以不同速率运行。

PWM AUX标签有CAP输出，通常用作[相机捕获/触发输入](../camera/fc_connected_camera.md#trigger-configuration)。
但是，您可以将CAP输出映射到其他输出功能，其他AUX输出可以用作相机捕获/触发输入。

::: info
配置相机捕获/触发输入需要重启才能生效
:::

您应该将功能分配给与电机和舵机物理接线匹配的输出，并使用下面描述的[执行器测试](#执行器测试)部分来确定适当的输出参数值。
这些步骤在[输出分配和配置](#输出分配和配置)中涵盖。

### 输出功能

输出功能用于将机架的"逻辑功能"（如`电机1`或`起落架`）映射到物理输出（如FMU输出引脃2）。
这使得可以轻松地将特定输出引脚用于几乎任何目的。

某些功能仅与特定机架或输出类型相关，在其他情况下不会提供。

功能包括：

- `禁用`：输出没有分配功能。
- `恒定最小值`：输出设置为恒定最小值（-1）。
- `恒定最大值`：输出设置为恒定最大值（+1）。
- `电机1`到`电机12`：输出是指示的电机。
  只显示机架允许的电机。
- `舵机1`到`舵机8`：舵机输出。
  这些根据机架进一步分配特定含义，如"倾转舵机"、"左副翼"。
- `外围设备通过执行器组1`到`外围设备通过执行器组6`：[使用MAVLink的通用执行器控制](../payloads/generic_actuator_control.md#generic-actuator-control-with-mavlink)。
- `起落架`：输出是起落架。
- `降落伞`：输出是降落伞。
  正常使用时发送最小值，触发故障安全时发射最大值。
- `RC滚转`：输出是来自RC的滚转透传（[RC_MAP_ROLL](../advanced_config/parameter_reference.md#RC_MAP_ROLL)将RC通道映射到此输出）。
- `RC俯仰`：输出是来自RC的俯仰透传（[RC_MAP_PITCH](../advanced_config/parameter_reference.md#RC_MAP_PITCH)将RC通道映射到此输出）。
- `RC油门`：输出是来自RC的油门透传（[RC_MAP_THROTTLE](../advanced_config/parameter_reference.md#RC_MAP_THROTTLE)将RC通道映射到此输出）。
- `RC偏航`：输出是来自RC的偏航（[RC_MAP_YAW](../advanced_config/parameter_reference.md#RC_MAP_YAW)将RC通道映射到此输出）。
- `RC襴翼`：输出是来自RC的襴翼（[RC_MAP_FLAPS](../advanced_config/parameter_reference.md#RC_MAP_FLAPS)将RC通道映射到此输出）。
- `RC AUXn`到`RC AUX1`：用于[由RC透传触发的任意载荷](../payloads/generic_actuator_control.md#generic-actuator-control-with-rc)的输出。
- `云台滚转`：输出控制云台滚转。
- `云台俯仰`：输出控制云台俯仰。
- `云台偏航`：输出控制云台偏航。
- `抓手`<Badge type="tip" text="PX4 v1.14" />：输出控制抓手开/关。
- `起落架轮`<Badge type="tip" text="PX4 v1.14" />：输出控制起落架轮的展开

以下功能只能应用于FMU输出：

- `相机触发`：触发相机的输出。
  当[`TRIG_MODE==0`](../advanced_config/parameter_reference.md#TRIG_MODE)时启用。
  通过`TRIG_*`参数配置。
- `相机捕获`：获取图像捕获通知的输入。
  当[CAM_CAP_FBACK==0](../advanced_config/parameter_reference.md#CAM_CAP_FBACK)时启用。
  通过`CAM_CAP_*`参数配置。
- `PPS输入`：每秒脉冲输入捕获。
  用于GPS同步。
  当[`PPS_CAP_ENABLE==0`](../advanced_config/parameter_reference.md#PPS_CAP_ENABLE)时启用

::: info
功能在源代码中定义：[/src/lib/mixer_module/output_functions.yaml](https://github.com/PX4/PX4-Autopilot/blob/main/src/lib/mixer_module/output_functions.yaml)。
此列表在PX4 v1.15中正确。
:::

## 执行器测试

右下角的_执行器测试_部分提供可用于测试（和确定）执行器和电机设置的滑块。
为[执行器输出](#执行器输出)部分中定义的每个输出提供滑块。
下面的滑块示例显示了典型VTOL倾转旋翼机架的部分。

![Actuator Testing Slider](../../assets/config/actuators/vtol_tiltrotor_sliders_example.png)

该部分有一个**启用滑块**开关，必须在使用滑块之前切换。
滑块可以在电机/舵机的整个运动范围内为其供电，并"捕捉"到解锁和最小位置。

::: info
切换**启用滑块**开关后，执行器/电机在相应滑块_移动_之前不会做任何事情。
这是防止开关启用后突然电机移动的安全功能。
:::

滑块可用于验证以下内容：

1. 执行器（电机、操纵面等）被分配给预期输出。
1. 电机在`解锁`PWM输出值时不旋转
1. 电机在`最小`PWM输出值时勉强旋转。
1. 电机在预期方向给出**正推力**
1. 操纵面在`解锁`输出值时处于正确的空闲位置
1. 操纵面按照[操纵面约定](#操纵面偏转约定)中定义的方向移动
1. 电机倾转舵机在`解锁`输出值时处于正确的空闲位置
1. 电机倾转舵朼按照[倾转舵机约定](#倾转舵机坐标系统)中定义的方向移动

## 输出分配和配置

输出在[执行器输出](#执行器输出)部分分配给功能并配置，而[执行器测试](#执行器测试)滑块通常用于确定要输入的适当配置值：

- 将电机连接到PWM输出的MC飞行器可以使用[识别和分配电机](#多旋翼pwm电机分配)按钮"半自动"执行电机分配。
- 电机和执行器的输出分配都可以使用滑块完成/检查（见[输出分配（手动）](#输出分配手动)）。
- 所有输出的解锁、最小和最大设置也可以使用滑块确定。
  这显示为[电机配置](#电机配置)、[操纵面设置](#操纵面设置)、[倾转舵机设置](#倾转舵机设置)的一部分

### 多旋翼PWM：电机分配

您可以使用**识别和分配电机**按钮使用半自动化过程将电机分配给PWM输出。

::: info
这是分配电机的最简单方法，但目前仅支持连接到PWM输出的**多旋翼飞行器**上的电机（UAVCAN输出和其他机架类型不支持此功能）。
在其他机架上，您可以按照[输出分配（手动）](#输出分配手动)中的说明操作。
:::

:::warning
分配输出或任何测试之前请从电机上卸下螺旋桥。
:::

![Identify motor button](../../assets/config/actuators/identify_motors_button.png)

当您点击按钮时，QGC向电机发送命令，使其旋转。
要将该电机分配给输出，您只需选择屏幕中显示的相应电机。
QGC然后会旋转下一个电机供您分配，依此类推。

说明：

1. 设置电机几何结构以匹配机架上的电机。
1. 选择要分配电机的PWM标签页。
1. 点击**识别和分配电机**按钮。
1. 一个电机开始旋转（如果它停止旋转太快无法注意到，请点击**再次旋转电机**。）

   在几何结构部分选择相应的电机。

   ![Screenshot showing how to identify/assign motors](../../assets/config/actuators/identify_motors_in_progress.png)

1. 分配所有电机后，工具将为输出设置正确的电机映射，然后退出。

### 输出分配（手动）

:::warning
分配输出或任何测试之前请从电机上卸下螺旋桥。
:::

电机和舵机的执行器输出都可以使用[执行器测试](#执行器测试)部分中的滑块_手动_分配。

分配执行器：

1. 首先在_执行器输出_部分将功能分配给您认为_可能_正确的输出。
1. 在_执行器测试_部分切换**启用滑块**开关。
1. 移动要测试的执行器滑块：
   - 电机应移动到最小推力位置。
   - 舵机应移动到接近中间位置。
1. 检查飞行器上哪个执行器移动。
   这应与您的几何结构的执行器位置匹配（[机架参考](../airframes/airframe_reference.md)显示了许多标准机架的电机位置）。
   - 如果正确的执行器移动，则继续下一步。
   - 如果错误的执行器移动，请交换输出分配。
   - 如果没有移动，则将滑块增加到范围的中间，如果需要则更高。
     如果之后仍没有移动，输出可能未连接，电机可能未供电，或输出可能配置错误。
     您需要故障排除（也许尝试其他执行器输出看是否有"任何东西"移动）。
1. 将滑块返回"解锁"位置（电机滑块底部，舵机滑块中心）。
1. 对所有执行器重复

### 电机配置

::: info
如果使用PWM或OneShot ESC，您应该首先执行[ESC校准](../advanced_config/esc_calibration.md)（此主题也涵盖PWM特定的电机配置）。

[DShot](../peripherals/dshot.md) ESC不需要配置命令限制，只需要旋转方向。
:::

:::warning
拆除螺旋桥！
:::

电机配置设置输出值，使电机：

- 解锁时不旋转（在`解锁`PWM输出值时）。
- 在`最小`PWM输出值时勉强但可靠地启动。
- 具有以_最高_速率旋转电机的_最低_`最大`PWM输出值。
- 在预期方向给出**正推力**。

对于每个电机：

1. 将电机滑块向下拉，使其捕捉到底部。
   在此位置，电机设置为输出的`解锁`值。
   - 验证电机在此位置不旋转。
   - 如果电机旋转，在[执行器输出](#执行器输出)部分将相应的PWM `解锁`值减少到仍然旋转的水平以下。
2. 慢慢向上移动滑块直到它捕捉到_最小_位置。
   在此位置，电机设置为输出的`最小`值。
   - 验证电机在此位置旋转非常缓慢。
   - 如果电机不旋转或旋转太快，您需要调整[执行器输出](#执行器输出)中相应的PWM `最小`值，使电机勉强旋转。

     ![PWM Minimum Output](../../assets/config/actuators/pwm_minimum_output.png)
     ::: info
     对于DShot输出，不需要此操作。
     :::

3. 将滑块值增加到可以验证电机向正确方向旋转并在预期方向产生正推力的水平。
   - 预期推力方向可因飞行器类型而异。
     例如在多旋翼中推力应始终向上，而在固定翼飞行器中推力将推动飞行器向前。
   - 对于VTOL，当倾转舵机处于[倾转舵机约定](#倾转舵机坐标系统)定义的0度时，推力应向上。
     [倾转舵机](#倾转舵机设置)的测试也在下面涵盖。
   - 如果推力方向错误，您可能需要[反转电机](#反转电机)。

4. 将滑块值增加到最大值，使电机快速旋转。
   将PWM输出的`最大`值减少到刚好低于默认值。
   在以小增量（25us）增加值时听取电机的音调。
   "最优"最大值是您最后听到音调变化的值。

### 操纵面设置

首先为每组输出中使用的舵机设置_帧速率_。
这通常设置为舵机支持的最大值。
下面我们显示如何将其设置为PWM50（最常见值）。

![Control Surface Disarmed 1500 Setting](../../assets/config/actuators/control_surface_disarmed_1500.png)

::: info
您几乎肯定需要从默认的400Hz更改脉冲速率，因为支持很少见（如果不支持，舵机通常会发出"奇怪"的噪音）。
如果您使用PWM舵机，PWM50更常见。
如果_真的_需要高速率舵机，DShot提供更好的价值。
:::

#### 围绕中性点双向移动的操纵面

围绕中性点双向移动的操纵面包括：副翼、升降副翼、V型尾翼、A型尾翼和方向舵。

设置这些：

1. 设置`解锁`值，使表面在解锁时保持中性位置。
   对于PWM舵机，这通常约为`1500`（接近舵机范围中心）。

2. 向上移动表面滑块（正命令）并验证它按[操纵面约定](#操纵面偏转约定)中定义的方向移动。
   - 副翼、升降副翼、V型尾翼、A型尾翼和其他水平表面应向上移动。
   - 方向舵和其他"纯垂直"表面应向右移动。

   ::: tip
   滑块移动匹配操纵面约定很重要，以标准化不同舵机安装的控制（向上移动滑块实际上可能减少发送给舵机的输出值）。
   :::

   如果操纵面向相反方向移动，点击`反转范围`复选框来反转范围。

3. 再次将滑块移动到中间并检查操纵面是否在机翼的中性位置对齐。
   - 如果未对齐，您可以为操纵面设置**配平**值。

     ::: info
     这在几何面板的`配平`设置中完成，通常通过"试验和错误"。
     ![Control Surface Trimming](../../assets/config/actuators/control_surface_trim.png)
     :::

   - 为操纵面设置配平后，将其滑块从中心移开，释放，然后回到解锁（中间）位置。
     确认表面处于中性位置。

#### 从中性到完全偏转的操纵面

只从中性向一个方向移动的操纵面包括：空气刹车、扰流板和襴翼。

对于这些控制，您应该根据控制的全范围设置最小和最大PWM值。
然后`解锁`值应匹配与控制处于"中性"位置对应的值（最大或最小）。
对于襴翼，即襴翼完全收回并与机翼齐平时。

### 倾转舵机设置

首先为每组输出中使用的舵机设置_帧速率_。
这通常设置为舵机支持的最大值。
下面设置为PWM50（最常见值）。
注意，设置的这部分与上面的操纵面相同。

![Tilt Servo Setup](../../assets/config/actuators/tilt_servo_setup.png)

对于每个倾转舵机：

1. 设置`解锁`值（例如PWM舵机的`1000`或`2000`），使舵机在_解锁_时位于预期方向。
2. 将舵机滑块置于最低位置，并验证正值增加将指向`最小倾转角度`（在几何结构部分定义）。
3. 将舵机滑块置于最高位置，并验证正电机推力将指向`最大倾转角度`（如几何结构部分定义）。

### 其他说明

- 如果使用安全按钮，必须在允许执行器测试之前按下它。
- 仍可使用终止开关立即停止电机。
- 舵机实际上不会移动，直到相应滑块改变。
- 参数[COM_MOT_TEST_EN](../advanced_config/parameter_reference.md#COM_MOT_TEST_EN)可用于完全禁用执行器测试。
- 在shell上，[actuator_test](../modules/modules_command.md#actuator-test)也可用于执行器测试。
- VTOL将在**固定翼飞行**期间自动关闭指向上方的电机：
  - 标准VTOL：定义为多旋翼电机的电机将关闭
  - 倾转旋翼：没有关联倾转舵机的电机将关闭
  - 尾座式在固定翼飞行中不会关闭任何电机

### 反转电机

电机必须按配置几何结构中定义的方向转动（"逆时针方向"复选框）。
如果任何电机不在正确方向转动，必须反转。

有几个选项：

- 如果ESC配置为[DShot](../peripherals/dshot.md)，您可以通过UI永久反转方向。
  如果使用DShot电机，**设置旋转方向**按钮显示在执行器滑块下方。
  这些弹出一个对话框，您选择要应用方向的电机。

  ![Set spin direction buttons](../../assets/config/actuators/reverse_dshot.png)

  注意无法查询当前方向，因此您可能需要尝试两个选项。

- 交换电机线中的3根中的2根（不管是哪两根）。

  ::: info
  如果电机没有通过子弹连接器连接，需要重新焦接（这是首选DShot ESC的原因之一）。
  :::
